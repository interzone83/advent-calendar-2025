<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Melville's Musical Advent Calendar 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
* { box-sizing: border-box; }
:root { --door-gap: 4%; }

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url("tree.jpg") center center / cover no-repeat fixed;
  color: #fff;
  text-align: center;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: hidden;
}

/* --- hide cog until hover --- */
.testing-wrapper {
  position: fixed;
  bottom: 12px;
  left: 12px;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.25s ease;
}
.testing-wrapper:hover { opacity: 1; }

#testingToggleButton {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.35);
  background: rgba(0,0,0,0.45);
  color: rgba(255,255,255,0.8);
  font-size: 20px;
  cursor: pointer;
}

#reset-panel {
  display: none;
  position: fixed;
  bottom: 60px;
  left: 12px;
  background: rgba(0,0,0,0.75);
  padding: 8px;
  border-radius: 10px;
}
#reset-panel.show { display: block; }

.calendar-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
.calendar-box {
  width: min(95vw, 75vh);
  height: min(95vw, 75vh);
}
.calendar {
  display: grid;
  grid-template-columns: repeat(5,1fr);
  grid-template-rows: repeat(5,1fr);
  gap: var(--door-gap);
  padding: var(--door-gap);
}

.door {
  background: rgba(200,0,0,0.9);
  border: 2px solid gold;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-weight: bold;
  position: relative;
}
.door.open { background: rgba(0,90,0,0.95); }

.door-number { z-index: 2; }
.door.open .door-number { opacity: 0; }

.door-image {
  position: absolute;
  inset: 4px;
  width: calc(100% - 8px);
  height: calc(100% - 8px);
  object-fit: cover;
  border-radius: 8px;
  opacity: 0;
}
.door.open .door-image { opacity: 1; }

#christmas-message {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: clamp(2.5rem,5vw,4rem);
  color: gold;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s;
  z-index: 20000;
}
#christmas-message.show {
  opacity: 1;
  pointer-events: auto;
}

#img-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
  z-index: 30000;
}
#img-modal.open { display: flex; }
#img-modal-content {
  width: 95vw;
  height: 95vh;
  object-fit: contain;
}

#now-playing {
  position: fixed;
  bottom: 2%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.65);
  padding: 0.6rem 1.2rem;
  border-radius: 12px;
  color: gold;
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 25000;
}
#now-playing.show { opacity: 1; }
</style>
</head>

<body>

<div id="christmas-message">üéÑ Merry Christmas Melville! üéÑ</div>
<div id="img-modal"><img id="img-modal-content"></div>
<div id="now-playing"></div>

<div class="testing-wrapper">
  <button id="testingToggleButton">‚öôÔ∏è</button>
  <div id="reset-panel">
    <button id="reset-all-btn">Reset ALL doors</button>
  </div>
</div>

<h1>Melville's Musical Advent Calendar 2025</h1>

<div class="calendar-wrapper">
  <div class="calendar-box">
    <div class="calendar" id="calendar"></div>
  </div>
</div>

<script>
const PASSWORD = "xmas1234";
let adminUnlocked = false;

const nowPlayingBar = document.getElementById("now-playing");
const calendar = document.getElementById("calendar");
const message = document.getElementById("christmas-message");

const songInfo = {
  1:"Let's Dance - David Bowie",
  24:"I Like To Move It - Reel 2 Reel",
  25:"Christmas Song"
};

const audios = {};
let currentAudio = null;

/* password gate */
document.getElementById("testingToggleButton").onclick = () => {
  if (!adminUnlocked) {
    const p = prompt("Password:");
    if (p !== PASSWORD) return alert("Incorrect password");
    adminUnlocked = true;
  }
  document.getElementById("reset-panel").classList.toggle("show");
};

document.getElementById("reset-all-btn").onclick = () => {
  localStorage.removeItem("openedDoors_2025");
  location.reload();
};

function playSong(n, restart=true) {
  if (!audios[n]) audios[n] = new Audio(`music/${n}.mp3`);
  const audio = audios[n];

  if (currentAudio && currentAudio !== audio) {
    currentAudio.pause();
    currentAudio.currentTime = 0;
  }
  currentAudio = audio;

  nowPlayingBar.textContent = "üéµ " + (songInfo[n] || `Door ${n}`);
  nowPlayingBar.classList.add("show");

  if (restart) audio.currentTime = 0;
  audio.play();

  audio.onended = () => nowPlayingBar.classList.remove("show");
}

const opened = JSON.parse(localStorage.getItem("openedDoors_2025")||"{}");

const today = new Date().getDate();
const isDecember = new Date().getMonth() === 11;

for (let n=1;n<=25;n++){
  const d=document.createElement("div");
  d.className="door";
  if(opened[n]) d.classList.add("open");

  d.innerHTML=`<div class="door-number">${n}</div><img class="door-image" src="images/${n}.png">`;

  d.onclick=()=>{
    if(!isDecember||n>today){alert(`Door ${n} opens on Dec ${n}`);return;}
    d.classList.add("open");
    opened[n]=true;
    localStorage.setItem("openedDoors_2025",JSON.stringify(opened));

    if(n===25){
      playSong(25,true);
      message.classList.add("show");
      setTimeout(()=>{
        message.classList.remove("show");
        document.getElementById("img-modal-content").src=`images/${n}.png`;
        document.getElementById("img-modal").classList.add("open");
      },10000);
    } else {
      playSong(n,true);
      document.getElementById("img-modal-content").src=`images/${n}.png`;
      document.getElementById("img-modal").classList.add("open");
    }
  };
  calendar.appendChild(d);
}

document.getElementById("img-modal").onclick=()=>document.getElementById("img-modal").classList.remove("open");
</script>

</body>
</html>
